import{b as Y,c as ie,t as D,a as E,d as oe}from"../chunks/BMAaO01G.js";import"../chunks/BOg5CWdv.js";import{t as I,H as L,I as B,a8 as ne,ar as le,W as F,aj as de,as as ce,at as ve,O as fe,a4 as M,p as ue,au as pe,av as _e,a as ge,c as k,s as S,b as v,m as W,g as a,d as g,y as G,aq as me,aw as he}from"../chunks/Bf1BRtWD.js";import{s as ye,e as J}from"../chunks/C3miCCz0.js";import{i as K}from"../chunks/tPd_H1-1.js";import{e as R,i as U,s as Q}from"../chunks/DDyY53TC.js";import{t as we,s as V}from"../chunks/Bc8YJnBm.js";import{b as be}from"../chunks/DKMzew3c.js";import{i as xe}from"../chunks/Bv6Kditx.js";import{s as Ee,a as X}from"../chunks/tE-UxPOK.js";import{o as $e,a as De}from"../chunks/DtidD1Zz.js";import{a as Ce,s as Te}from"../chunks/5Hlt5eW_.js";import{b as ke}from"../chunks/DhvumiXS.js";function Ie(f,m,h=!1,y=!1,w=!1){var c=f,r="";I(()=>{var i=ne;if(r===(r=m()??"")){L&&B();return}if(i.nodes_start!==null&&(le(i.nodes_start,i.nodes_end),i.nodes_start=i.nodes_end=null),r!==""){if(L){F.data;for(var l=B(),$=l;l!==null&&(l.nodeType!==8||l.data!=="");)$=l,l=de(l);if(l===null)throw ce(),ve;Y(F,$),c=fe(l);return}var b=r+"";h?b=`<svg>${b}</svg>`:y&&(b=`<math>${b}</math>`);var u=ie(b);if((h||y)&&(u=M(u)),Y(M(u),u.lastChild),h||y)for(;M(u);)c.before(M(u));else c.before(u)}})}function Me(f,m,h,y){var w=f.__style;if(L||w!==m){var c=we(m);(!L||c!==f.getAttribute("style"))&&(c==null?f.removeAttribute("style"):f.style.cssText=c),f.__style=m}return y}const Re=!0,Ze=Object.freeze(Object.defineProperty({__proto__:null,prerender:Re},Symbol.toStringTag,{value:"Module"}));var Ue=D("<button> </button>"),Le=D('<div><video autoplay playsinline="" class="rounded shadow transition-transform duration-300 cursor-pointer"></video></div>',2),qe=D('<img class="h-48 p-1 rounded">'),Ae=D('<div><div class="bg-cyan-900 bg-opacity-80 text-white text-sm px-4 py-1 overflow-scroll h-48 rounded-br z-10"><!></div> <!></div>'),He=D('<div class="w-full flex flex-col gap-2 mt-6"></div>'),ze=D('<section class="flex flex-col items-center gap-4 p-4"><div class="flex flex-wrap justify-center gap-2"></div> <div class="flex items-center justify-between gap-4 p-4 text-lg rounded shadow"></div> <!></section>');function je(f,m){ue(m,!1);const[h,y]=Ee(),w=()=>X(Ce,"$scancount",h),c=()=>X(Te,"$scanner",h);let r=W([]),i=W([]),l=[],$=W(0);const b=async()=>{let e=a(r).filter(s=>s.active&&s.videoEl).map(s=>O(s.videoEl,s.rotation));const t={scan:c(),c:w(),confirmed:"no",image:[...e]};v(i,[...a(i),t]),setTimeout(async()=>{if(Math.random()>.1)t.confirmed="yes",v(i,[...a(i)]),setTimeout(()=>{v(i,a(i).filter(o=>o.c!==t.c))},6e3);else{const o=await ke.toDataURL(c(),{errorCorrectionLevel:"L",margin:2,scale:8,color:{dark:"#000000",light:"#ffffff"}});t.image.push(o),t.confirmed="error",v(i,[...a(i)])}},3e3)},u=e=>{e.rotation=(e.rotation+90)%360,v(r,[...a(r)])},Z=async(e,t=3840,s=2160)=>{e.active||(e.landscape||([t,s]=[s,t]),e.stream=await navigator.mediaDevices.getUserMedia({video:{deviceId:{exact:e.device.deviceId},width:{ideal:t},height:{ideal:s}},audio:!1}),e.active=!0,v(r,[...a(r)]),setTimeout(()=>{e.videoEl&&(e.videoEl.srcObject=e.stream)},10))},j=async e=>{e.active?N(e):Z(e),v(r,[...a(r)])},N=e=>{var t;(t=e.stream)==null||t.getTracks().forEach(s=>s.stop()),e.stream=null,e.active=!1,e.videoEl&&(e.videoEl.srcObject=null)},O=(e,t=0)=>{if(!e)return null;const s=e.videoWidth,o=e.videoHeight,n=document.createElement("canvas"),d=n.getContext("2d");return t%180===0?(n.width=s,n.height=o):(n.width=o,n.height=s),d?(d.save(),d.translate(n.width/2,n.height/2),d.rotate(t*Math.PI/180),d.drawImage(e,-s/2,-o/2),d.restore(),n.toDataURL("image/png")):null};$e(async()=>{v(i,[]),await navigator.mediaDevices.getUserMedia({video:!0}),l=(await navigator.mediaDevices.enumerateDevices()).filter(t=>t.kind==="videoinput"),v(r,l.map(t=>({device:t,stream:null,videoEl:null,active:!1,rotation:0,landscape:!0})))}),De(()=>{a(r).forEach(e=>N(e))}),pe(()=>(w(),a($)),()=>{w()!==a($)&&(v($,w()),b())}),_e(),xe();var q=ze(),A=k(q);R(A,5,()=>a(r),U,(e,t)=>{var s=Ue();let o;var n=k(s);g(s),I(d=>{o=V(s,1,"px-4 py-2 rounded shadow transition",null,o,d),ye(n,`${a(t).device.label||"Unnamed Camera"} ${a(t).active?"ðŸŸ¢":"âšª"}`)},[()=>({"bg-green-700":a(t).active,"bg-gray-800":!a(t).active,"text-white":!0})],G),J("click",s,()=>j(a(t))),E(e,s)}),g(A);var H=S(A,2);R(H,5,()=>a(r),U,(e,t,s)=>{var o=oe(),n=me(o);{var d=C=>{var x=Le(),p=k(x);be(p,(_,T)=>(T.videoEl=_,he(()=>a(r))),_=>_==null?void 0:_.videoEl,()=>[a(t)]),g(x),I(()=>Me(p,`transform: rotate(${a(t).rotation??""}deg);`)),J("click",p,()=>u(a(t))),E(C,x)};K(n,C=>{a(t).active&&C(d)})}E(e,o)}),g(H);var ee=S(H,2);{var te=e=>{var t=He();R(t,5,()=>[...a(i)].reverse(),U,(s,o,n)=>{let d=()=>a(o).scan,C=()=>a(o).image,x=()=>a(o).confirmed;var p=Ae();let _;var T=k(p),ae=k(T);Ie(ae,()=>d().split("").join("<br>")),g(T);var se=S(T,2);R(se,1,C,U,(z,re)=>{var P=qe();Q(P,"alt",`Capture ${n+1}`),I(()=>Q(P,"src",a(re))),E(z,P)}),g(p),I(z=>_=V(p,1,"flex items-center opacity-70 justify-between gap-4 text-lg overflow-hidden overflow-x-scroll rounded-md",null,_,z),[()=>({"bg-emerald-300":x()=="yes","bg-cyan-600":x()=="no","bg-rose-400":x()=="error"})],G),E(s,p)}),g(t),E(e,t)};K(ee,e=>{a(i).length&&e(te)})}g(q),E(f,q),ge(),y()}export{je as component,Ze as universal};
