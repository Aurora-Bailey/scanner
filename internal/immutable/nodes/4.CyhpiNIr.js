import{t as u,a as f,c as V}from"../chunks/B7V-whKc.js";import"../chunks/BW6EN79o.js";import{B as W,a0 as j,a3 as O,a4 as ee,a2 as te,Y as x,X as w,s as y,m as q,g as a,Z as v,W as k,n as ae,a1 as se,a5 as ie,a6 as z}from"../chunks/BIeHt8rZ.js";import{s as H,e as R}from"../chunks/D4bqg6A1.js";import{i as X}from"../chunks/DKlYyJzN.js";import{t as re,e as $,i as E,s as oe,a as b}from"../chunks/_fjmeoBt.js";import{b as ne}from"../chunks/BcAGQpdC.js";import{i as le}from"../chunks/DJF4X7OK.js";import{s as ve,a as de}from"../chunks/BSBo1yJd.js";import{o as ce,a as fe}from"../chunks/DtAfHwvy.js";import{s as pe}from"../chunks/Bde_f8Z_.js";function ue(d,g,A,C){var _=d.__style;if(W||_!==g){var i=re(g);(!W||i!==d.getAttribute("style"))&&(i==null?d.removeAttribute("style"):d.style.cssText=i),d.__style=g}return C}const ge=!0,Te=Object.freeze(Object.defineProperty({__proto__:null,prerender:ge},Symbol.toStringTag,{value:"Module"}));var _e=u("<button> </button>"),he=u('<div><video autoplay playsinline="" class="rounded shadow transition-transform duration-300 cursor-pointer"></video></div>',2),me=u('<img class="h-24 rounded">'),xe=u('<div class="flex items-center justify-between gap-4 p-4 bg-cyan-600 text-lg rounded shadow"><button class="text-white hover:text-red-400 transition"><svg class="w-8 h-8" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" d="M6 18L18 6M6 6l12 12"></path></svg></button> <span class="flex-1 text-white truncate"> </span> <div class="flex gap-1"></div> <button class="hover:text-lime-400 transition"><svg class="w-8 h-8" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" d="M5 13l4 4L19 7"></path></svg></button></div>'),we=u('<div class="w-full flex flex-col gap-2 mt-6"></div>'),ye=u('<section class="flex flex-col items-center gap-4 p-4"><div class="flex flex-wrap justify-center gap-2"></div> <div class="flex items-center justify-between gap-4 p-4 text-lg rounded shadow"></div> <!></section>');function Ae(d,g){j(g,!1);const[A,C]=ve(),_=()=>de(pe,"$scanner",A);let i=q([]),h=q([]),P=[];const Y=e=>{e.rotation=(e.rotation+90)%360,y(i,[...a(i)])},S=async(e,t=3840,s=2160)=>{e.active||(e.landscape||([t,s]=[s,t]),e.stream=await navigator.mediaDevices.getUserMedia({video:{deviceId:{exact:e.device.deviceId},width:{ideal:t},height:{ideal:s}},audio:!1}),e.active=!0,y(i,[...a(i)]),await z(),e.videoEl&&(e.videoEl.srcObject=e.stream))},Z=async e=>{e.landscape&&e.active?(D(e),e.landscape=!1,await z(),await S(e)):e.active?(D(e),e.landscape=!0):S(e),y(i,[...a(i)])},D=e=>{var t;(t=e.stream)==null||t.getTracks().forEach(s=>s.stop()),e.stream=null,e.active=!1,e.videoEl&&(e.videoEl.srcObject=null)},F=(e,t=0)=>{if(!e)return null;const s=e.videoWidth,o=e.videoHeight,r=document.createElement("canvas"),n=r.getContext("2d");return t%180===0?(r.width=s,r.height=o):(r.width=o,r.height=s),n?(n.save(),n.translate(r.width/2,r.height/2),n.rotate(t*Math.PI/180),n.drawImage(e,-s/2,-o/2),n.restore(),r.toDataURL("image/png")):null};ce(async()=>{await navigator.mediaDevices.getUserMedia({video:!0}),P=(await navigator.mediaDevices.enumerateDevices()).filter(t=>t.kind==="videoinput"),y(i,P.map(t=>({device:t,stream:null,videoEl:null,active:!1,rotation:0,landscape:!0})))}),fe(()=>{a(i).forEach(e=>D(e))}),O(()=>(_(),a(i),a(h)),()=>{if(_()){const e=a(i).filter(t=>t.active&&t.videoEl).map(t=>F(t.videoEl,t.rotation)).filter(t=>!!t);y(h,[...a(h),{scan:_(),image:e}])}}),ee(),le();var M=ye(),I=x(M);$(I,5,()=>a(i),E,(e,t)=>{var s=_e();let o;var r=x(s);v(s),k(n=>{o=oe(s,1,"px-4 py-2 rounded shadow transition",null,o,n),H(r,`${a(t).device.label||"Unnamed Camera"} ${a(t).active?"ðŸŸ¢":"âšª"}`)},[()=>({"bg-green-700":a(t).active,"bg-gray-800":!a(t).active,"text-white":!0})],ae),R("click",s,()=>Z(a(t))),f(e,s)}),v(I);var U=w(I,2);$(U,5,()=>a(i),E,(e,t,s)=>{var o=V(),r=se(o);{var n=m=>{var c=he(),p=x(c);ne(p,(l,B)=>(B.videoEl=l,ie(()=>a(i))),l=>l==null?void 0:l.videoEl,()=>[a(t)]),v(c),k(()=>ue(p,`transform: rotate(${a(t).rotation??""}deg);`)),R("click",p,()=>Y(a(t))),f(m,c)};X(r,m=>{a(t).active&&m(n)})}f(e,o)}),v(U);var G=w(U,2);{var J=e=>{var t=we();$(t,5,()=>[...a(h)].reverse(),E,(s,o,r)=>{let n=()=>a(o).scan,m=()=>a(o).image;var c=xe(),p=x(c);b(p,"aria-label",`Delete scan ${r+1}`);var l=w(p,2),B=x(l,!0);v(l);var L=w(l,2);$(L,5,m,E,(N,Q)=>{var T=me();b(T,"alt",`Capture ${r+1}`),k(()=>b(T,"src",a(Q))),f(N,T)}),v(L);var K=w(L,2);b(K,"aria-label",`Confirm scan ${r+1}`),v(c),k(()=>H(B,n())),f(s,c)}),v(t),f(e,t)};X(G,e=>{a(h).length&&e(J)})}v(M),f(d,M),te(),C()}export{Ae as component,Te as universal};
