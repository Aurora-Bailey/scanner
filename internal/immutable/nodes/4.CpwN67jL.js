import{b as N,c as ie,t as D,a as E,d as oe}from"../chunks/ClwgQ8as.js";import"../chunks/B2UTNCZh.js";import{X as I,h as A,D as W,ac as ne,aA as le,O as X,a2 as de,a5 as ce,a3 as ve,I as fe,a1 as M,ab as ue,aB as _e,aC as pe,ad as ge,Z as k,Y as S,s as v,m as Y,g as a,_ as g,t as Z,aw as me,aD as he}from"../chunks/DUbyFJnh.js";import{s as ye}from"../chunks/COGe5nV6.js";import{i as F}from"../chunks/CGbttzPy.js";import{e as R,i as U,s as G}from"../chunks/vKC_hMtw.js";import{t as we,s as J}from"../chunks/DgZ0gb-F.js";import{e as K}from"../chunks/DBuS7V1I.js";import{b as be}from"../chunks/CzwRRWbO.js";import{i as xe}from"../chunks/Bp2O5x0V.js";import{s as Ee,a as Q}from"../chunks/BzYrj30C.js";import{o as $e,a as De}from"../chunks/Bod87O3u.js";import{a as Ce,s as Te}from"../chunks/Cpk99WGo.js";import{b as ke}from"../chunks/DhvumiXS.js";function Ie(f,m,h=!1,y=!1,w=!1){var c=f,r="";I(()=>{var i=ne;if(r===(r=m()??"")){A&&W();return}if(i.nodes_start!==null&&(le(i.nodes_start,i.nodes_end),i.nodes_start=i.nodes_end=null),r!==""){if(A){X.data;for(var l=W(),$=l;l!==null&&(l.nodeType!==8||l.data!=="");)$=l,l=de(l);if(l===null)throw ce(),ve;N(X,$),c=fe(l);return}var b=r+"";h?b=`<svg>${b}</svg>`:y&&(b=`<math>${b}</math>`);var u=ie(b);if((h||y)&&(u=M(u)),N(M(u),u.lastChild),h||y)for(;M(u);)c.before(M(u));else c.before(u)}})}function Me(f,m,h,y){var w=f.__style;if(A||w!==m){var c=we(m);(!A||c!==f.getAttribute("style"))&&(c==null?f.removeAttribute("style"):f.style.cssText=c),f.__style=m}return y}const Re=!0,je=Object.freeze(Object.defineProperty({__proto__:null,prerender:Re},Symbol.toStringTag,{value:"Module"}));var Ue=D("<button> </button>"),Ae=D('<div><video autoplay playsinline="" class="rounded shadow transition-transform duration-300 cursor-pointer"></video></div>',2),Le=D('<img class="h-48 p-1 rounded">'),qe=D('<div><div class="bg-cyan-900 bg-opacity-80 text-white text-sm px-4 py-1 overflow-scroll h-48 rounded-br z-10"><!></div> <!></div>'),ze=D('<div class="w-full flex flex-col gap-2 mt-6"></div>'),He=D('<section class="flex flex-col items-center gap-4 p-4"><div class="flex flex-wrap justify-center gap-2"></div> <div class="flex items-center justify-between gap-4 p-4 text-lg rounded shadow"></div> <!></section>');function Oe(f,m){ue(m,!1);const[h,y]=Ee(),w=()=>Q(Ce,"$scancount",h),c=()=>Q(Te,"$scanner",h);let r=Y([]),i=Y([]),l=[],$=Y(0);const b=async()=>{let e=a(r).filter(s=>s.active&&s.videoEl).map(s=>O(s.videoEl,s.rotation));const t={scan:c(),c:w(),confirmed:"no",image:[...e]};v(i,[...a(i),t]),setTimeout(async()=>{if(Math.random()>.1)t.confirmed="yes",v(i,[...a(i)]),setTimeout(()=>{v(i,a(i).filter(o=>o.c!==t.c))},6e3);else{const o=await ke.toDataURL(c(),{errorCorrectionLevel:"L",margin:2,scale:8,color:{dark:"#000000",light:"#ffffff"}});t.image.push(o),t.confirmed="error",v(i,[...a(i)])}},3e3)},u=e=>{e.rotation=(e.rotation+90)%360,v(r,[...a(r)])},V=async(e,t=3840,s=2160)=>{e.active||(e.landscape||([t,s]=[s,t]),e.stream=await navigator.mediaDevices.getUserMedia({video:{deviceId:{exact:e.device.deviceId},width:{ideal:t},height:{ideal:s}},audio:!1}),e.active=!0,v(r,[...a(r)]),setTimeout(()=>{e.videoEl&&(e.videoEl.srcObject=e.stream)},10))},j=async e=>{e.active?B(e):V(e),v(r,[...a(r)])},B=e=>{var t;(t=e.stream)==null||t.getTracks().forEach(s=>s.stop()),e.stream=null,e.active=!1,e.videoEl&&(e.videoEl.srcObject=null)},O=(e,t=0)=>{if(!e)return null;const s=e.videoWidth,o=e.videoHeight,n=document.createElement("canvas"),d=n.getContext("2d");return t%180===0?(n.width=s,n.height=o):(n.width=o,n.height=s),d?(d.save(),d.translate(n.width/2,n.height/2),d.rotate(t*Math.PI/180),d.drawImage(e,-s/2,-o/2),d.restore(),n.toDataURL("image/png")):null};$e(async()=>{v(i,[]),await navigator.mediaDevices.getUserMedia({video:!0}),l=(await navigator.mediaDevices.enumerateDevices()).filter(t=>t.kind==="videoinput"),v(r,l.map(t=>({device:t,stream:null,videoEl:null,active:!1,rotation:0,landscape:!0})))}),De(()=>{a(r).forEach(e=>B(e))}),_e(()=>(w(),a($)),()=>{w()!==a($)&&(v($,w()),b())}),pe(),xe();var L=He(),q=k(L);R(q,5,()=>a(r),U,(e,t)=>{var s=Ue();let o;var n=k(s);g(s),I(d=>{o=J(s,1,"px-4 py-2 rounded shadow transition",null,o,d),ye(n,`${a(t).device.label||"Unnamed Camera"} ${a(t).active?"ðŸŸ¢":"âšª"}`)},[()=>({"bg-green-700":a(t).active,"bg-gray-800":!a(t).active,"text-white":!0})],Z),K("click",s,()=>j(a(t))),E(e,s)}),g(q);var z=S(q,2);R(z,5,()=>a(r),U,(e,t,s)=>{var o=oe(),n=me(o);{var d=C=>{var x=Ae(),_=k(x);be(_,(p,T)=>(T.videoEl=p,he(()=>a(r))),p=>p==null?void 0:p.videoEl,()=>[a(t)]),g(x),I(()=>Me(_,`transform: rotate(${a(t).rotation??""}deg);`)),K("click",_,()=>u(a(t))),E(C,x)};F(n,C=>{a(t).active&&C(d)})}E(e,o)}),g(z);var ee=S(z,2);{var te=e=>{var t=ze();R(t,5,()=>[...a(i)].reverse(),U,(s,o,n)=>{let d=()=>a(o).scan,C=()=>a(o).image,x=()=>a(o).confirmed;var _=qe();let p;var T=k(_),ae=k(T);Ie(ae,()=>d().split("").join("<br>")),g(T);var se=S(T,2);R(se,1,C,U,(H,re)=>{var P=Le();G(P,"alt",`Capture ${n+1}`),I(()=>G(P,"src",a(re))),E(H,P)}),g(_),I(H=>p=J(_,1,"flex items-center opacity-70 justify-between gap-4 text-lg overflow-hidden overflow-x-scroll rounded-md",null,p,H),[()=>({"bg-emerald-300":x()=="yes","bg-cyan-600":x()=="no","bg-rose-400":x()=="error"})],Z),E(s,_)}),g(t),E(e,t)};F(ee,e=>{a(i).length&&e(te)})}g(L),E(f,L),ge(),y()}export{Oe as component,je as universal};
