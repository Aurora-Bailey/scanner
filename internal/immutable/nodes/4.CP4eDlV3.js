import{t as y,a as h}from"../chunks/CyAu5rH_.js";import"../chunks/CrLXABb0.js";import{x as k,y as U,z,A as P,v as _,s as l,m as x,g as a,w as f,o as S,B as T,C as w}from"../chunks/BPGy-j5v.js";import{s as q,e as A}from"../chunks/Luvf0ARE.js";import{e as B,i as H,s as L}from"../chunks/BCxiddJg.js";import{i as R}from"../chunks/C2IxcfUl.js";import{s as W,a as F}from"../chunks/C6AXLoYd.js";import{o as G,a as J}from"../chunks/BmTuMzv4.js";import{s as K}from"../chunks/DKTU0hcx.js";const N=!0,ae=Object.freeze(Object.defineProperty({__proto__:null,prerender:N},Symbol.toStringTag,{value:"Module"}));var Q=y("<button> </button>"),V=y('<section class="flex flex-col items-center gap-4 p-4"><div class="flex flex-wrap justify-center gap-2"></div></section>');function ie(E,$){k($,!1);const[D,C]=W(),c=()=>F(K,"$scanner",D);let o=x([]),d=x([]),u=[];const g=async(e,t=3840,s=2160)=>{e.active||(e.landscape||([t,s]=[s,t]),console.log(t,s),e.stream=await navigator.mediaDevices.getUserMedia({video:{deviceId:{exact:e.device.deviceId},width:{ideal:t},height:{ideal:s}},audio:!1}),e.active=!0,l(o,[...a(o)]),await w(),e.videoEl&&(e.videoEl.srcObject=e.stream))},I=e=>{e.landscape&&e.active?(v(e),e.landscape=!1,w(),g(e)):e.active?(v(e),e.landscape=!0):g(e),l(o,[...a(o)])},v=e=>{var t;(t=e.stream)==null||t.getTracks().forEach(s=>s.stop()),e.stream=null,e.active=!1,e.videoEl&&(e.videoEl.srcObject=null)},M=(e,t=0)=>{if(!e)return null;const s=e.videoWidth,r=e.videoHeight,i=document.createElement("canvas"),n=i.getContext("2d");return t%180===0?(i.width=s,i.height=r):(i.width=r,i.height=s),n?(n.save(),n.translate(i.width/2,i.height/2),n.rotate(t*Math.PI/180),n.drawImage(e,-s/2,-r/2),n.restore(),i.toDataURL("image/png")):null};G(async()=>{await navigator.mediaDevices.getUserMedia({video:!0}),u=(await navigator.mediaDevices.enumerateDevices()).filter(t=>t.kind==="videoinput"),l(o,u.map(t=>({device:t,stream:null,videoEl:null,active:!1,rotation:0,landscape:!0})))}),J(()=>{a(o).forEach(e=>v(e))}),U(()=>(c(),a(o),a(d)),()=>{if(c()){const e=a(o).filter(t=>t.active&&t.videoEl).map(t=>M(t.videoEl,t.rotation)).filter(t=>!!t);l(d,[...a(d),{scan:c(),image:e}])}}),z(),R();var p=V(),m=_(p);B(m,5,()=>a(o),H,(e,t)=>{var s=Q();let r;var i=_(s);f(s),S(n=>{r=L(s,1,"px-4 py-2 rounded shadow transition",null,r,n),q(i,`${a(t).device.label||"Unnamed Camera"} ${a(t).active?"ðŸŸ¢":"âšª"}`)},[()=>({"bg-green-700":a(t).active,"bg-gray-800":!a(t).active,"text-white":!0})],T),A("click",s,()=>I(a(t))),h(e,s)}),f(m),f(p),h(E,p),P(),C()}export{ie as component,ae as universal};
